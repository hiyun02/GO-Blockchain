<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>OTT Block Detail</title>
    <style>
        body { font-family: Arial; margin: 20px; }
        pre { background:#f6f6f6; padding:10px; white-space: pre-wrap; }
        .record { border:1px solid #ccc; padding:10px; margin:10px 0; }
    </style>
</head>
<body>

<h1>OTT 블록 상세보기</h1>

<div id="meta"></div>

<h2>Anchor Records</h2>
<div id="records"></div>

<script>
    const params = new URLSearchParams(window.location.search);
    const id = params.get("id");

    fetch(`/block/index?id=${id}`)
        .then(r => r.json())
        .then(b => {

            // UpperBlock 메타 정보 표시
            document.getElementById('meta').innerHTML = `
                <p><b>Index:</b> ${b.index}</p>
                <p><b>OTT ID:</b> ${b.ott_id}</p>
                <p><b>Timestamp:</b> ${b.timestamp}</p>
                <p><b>PrevHash:</b> ${b.prev_hash}</p>
                <p><b>MerkleRoot:</b> ${b.merkle_root}</p>
                <p><b>Nonce:</b> ${b.nonce}</p>
                <p><b>Difficulty:</b> ${b.difficulty}</p>
                <p><b>Hash:</b> ${b.block_hash}</p>
            `;

            // records 배열 없을 경우 안전 처리
            const recs = Array.isArray(b.records) ? b.records : [];

            const html = recs.map((r, i) => `
                <div class="record">
                    <h3>${i+1}. CP: ${r.cp_id}</h3>

                    <p><b>Lower Root:</b> ${r.lower_root}</p>
                    <p><b>Anchor Timestamp:</b> ${r.anchor_ts}</p>

                    <h4>Access Catalog</h4>
                    <pre>${JSON.stringify(r.access_catalog, null, 2)}</pre>

                    <h4>Contract Snapshot</h4>
                    <pre>${JSON.stringify(r.contract_snapshot, null, 2)}</pre>
                </div>
            `).join('');

            document.getElementById('records').innerHTML = html;
        });
</script>

</body>
</html>
